#!/bin/sh

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE" | tr -d '\r')  # Remove potential CR characters (Windows compatibility)

# Define allowed commit types
TYPES="feat|fix|chore|docs|refactor|test|perf|ci|build|revert"

# Enforce: type(scope): message OR type: message (scope optional)
PATTERN="^($TYPES)(\([a-z0-9-]+\))?: .+$"

# Check if commit message is empty
if [ ! -s "$COMMIT_MSG_FILE" ]; then
  echo "❌ Commit message is empty!"
  exit 1
fi

# Validate commit message format
if ! printf "%s" "$COMMIT_MSG" | grep -Pq "$PATTERN"; then
  RED='\033[0;31m'
  NC='\033[0m' # No Color

  echo -e "${RED}❌ Invalid commit message format!${NC}"
  echo "   Format: type(scope): message OR type: message"
  echo "   Example: feat(auth): add login API"
  echo "   Example: fix(TICKET-123): resolve bug"
  exit 1
fi

