#!/bin/sh

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Regex: Type(scope): message (scope is optional)
PATTERN="^(feat|fix|chore|docs|refactor|test|perf|ci|build|revert)(\([a-z0-9-]+\))?: .+"

# Check if commit message file exists and is not empty
if [ ! -s "$COMMIT_MSG_FILE" ]; then
  echo "❌ Commit message is empty!"
  exit 1
fi

# Validate commit message format
if ! echo "$COMMIT_MSG" | grep -Eq "$PATTERN"; then
  RED='\033[0;31m'
  NC='\033[0m' # No Color

  echo -e "${RED}❌ Invalid commit message format!${NC}"
  echo "   Format: type(scope): message"
  echo "   Example: feat(auth): add login API"
  echo "   Example: fix(TICKET-123): resolve bug"
  exit 1
fi
